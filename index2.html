<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandon's Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --surface: #111118;
            --border: #1e1e2e;
            --header-bg: #16161f;
            --text: #c9c9e0;
            --text-bright: #eeeeff;
            --accent: #7c6af7;
            --green: #00e676;
            --red: #ff4444;
            --yellow: #ffd740;
            --dim: #555570;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Syne', sans-serif;
        }

```
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
        font-family: var(--mono);
        background-color: var(--bg);
        color: var(--text);
        padding: 12px;
        font-size: 13px;
        line-height: 1.5;
    }

    h1 {
        font-family: var(--sans);
        text-align: center;
        color: var(--text-bright);
        font-size: 1.6em;
        font-weight: 800;
        letter-spacing: -0.02em;
        padding: 16px 0 20px;
    }

    h1 span {
        color: var(--accent);
    }

    .last-update {
        text-align: center;
        font-size: 10px;
        color: var(--dim);
        margin-bottom: 16px;
        letter-spacing: 0.08em;
    }

    details {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 10px;
        margin-bottom: 12px;
        overflow: hidden;
    }

    summary {
        padding: 11px 14px;
        background: var(--header-bg);
        color: var(--text-bright);
        font-family: var(--sans);
        font-weight: 700;
        font-size: 0.95em;
        cursor: pointer;
        letter-spacing: 0.03em;
        border-bottom: 1px solid var(--border);
        list-style: none;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    summary::before {
        content: 'â–¶';
        font-size: 0.65em;
        color: var(--accent);
        transition: transform 0.2s;
    }

    details[open] summary::before {
        transform: rotate(90deg);
    }

    ul { list-style: none; }

    li {
        padding: 9px 14px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
    }

    li:last-child { border-bottom: none; }

    .label {
        color: var(--dim);
        font-size: 0.82em;
        letter-spacing: 0.04em;
        flex-shrink: 0;
    }

    .value {
        color: var(--text-bright);
        font-weight: 600;
        font-size: 0.88em;
        text-align: right;
    }

    .green { color: var(--green) !important; }
    .red   { color: var(--red) !important; }
    .yellow { color: var(--yellow) !important; }

    .loading { color: var(--dim); font-style: italic; }
    .error { color: var(--red); font-size: 0.78em; }

    #news-feed li {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }

    #news-feed a {
        color: var(--accent);
        text-decoration: none;
        font-size: 0.85em;
        line-height: 1.4;
    }

    #news-feed .news-date {
        color: var(--dim);
        font-size: 0.75em;
    }

    .section-icon { opacity: 0.7; }

    @media (min-width: 600px) {
        body { font-size: 14px; padding: 20px; max-width: 700px; margin: 0 auto; }
    }
</style>
```

</head>
<body>
    <h1>Brandon's <span>Dashboard</span></h1>
    <div class="last-update" id="last-update">Initializing...</div>

```
<details open>
    <summary>â‚¿ Bitcoin</summary>
    <ul id="btc-metrics">
        <li><span class="label">Bitcoin Price</span><span class="value loading" id="btc-price">Loading...</span></li>
        <li><span class="label">24hr Range</span><span class="value loading" id="range24">Loading...</span></li>
        <li><span class="label">Market Cap</span><span class="value loading" id="market-cap">Loading...</span></li>
        <li><span class="label">Sats per USD</span><span class="value loading" id="sats-usd">Loading...</span></li>
        <li><span class="label">ATH Price</span><span class="value loading" id="ath-price">Loading...</span></li>
        <li><span class="label">Drawdown Since ATH</span><span class="value loading" id="drawdown-ath">Loading...</span></li>
        <li><span class="label">ATH Date</span><span class="value loading" id="ath-date">Loading...</span></li>
        <li><span class="label">Fear &amp; Greed Index</span><span class="value loading" id="fear-greed">Loading...</span></li>
        <li><span class="label">Realized Price</span><span class="value loading" id="realized-price">Loading...</span></li>
        <li><span class="label">Block Height</span><span class="value loading" id="block-height">Loading...</span></li>
        <li><span class="label">Average Block Time</span><span class="value loading" id="avg-block-time">Loading...</span></li>
        <li><span class="label">Money Supply</span><span class="value loading" id="money-supply">Loading...</span></li>
        <li><span class="label">Estimated Retarget Date</span><span class="value loading" id="retarget-date">Loading...</span></li>
        <li><span class="label">Hash Rate (24hrs)</span><span class="value loading" id="hash-rate">Loading...</span></li>
        <li><span class="label">Median Fee â€“ Next Block</span><span class="value loading" id="fee-next">Loading...</span></li>
        <li><span class="label">Median Fee â€“ 30 Minutes</span><span class="value loading" id="fee-30min">Loading...</span></li>
        <li><span class="label">Median Fee â€“ 1 Hour</span><span class="value loading" id="fee-1hr">Loading...</span></li>
        <li><span class="label">Bitcoin Price in Gold Kg</span><span class="value loading" id="btc-gold-kg">Loading...</span></li>
        <li><span class="label">Bitcoin vs Gold Market Cap</span><span class="value loading" id="btc-gold-mc">Loading...</span></li>
        <li><span class="label">Gold Market Cap</span><span class="value loading" id="gold-mc">Loading...</span></li>
        <li><span class="label">50-Day Moving Average</span><span class="value loading" id="ma-50">Loading...</span></li>
        <li><span class="label">200-Day Moving Average</span><span class="value loading" id="ma-200">Loading...</span></li>
        <li><span class="label">Power Law Projected Price</span><span class="value loading" id="power-law-projected">Loading...</span></li>
        <li><span class="label">Price vs Power Law</span><span class="value loading" id="power-law-ratio">Loading...</span></li>
    </ul>
</details>

<details open>
    <summary>ğŸ“ˆ Stocks &amp; Other Assets</summary>
    <ul id="assets-metrics">
        <li><span class="label">Gold Spot</span><span class="value loading" id="gold">Loading...</span></li>
        <li><span class="label">Silver Spot</span><span class="value loading" id="silver">Loading...</span></li>
        <li><span class="label">S&amp;P 500 (SPY)</span><span class="value loading" id="sp500">Loading...</span></li>
        <li><span class="label">DOW (DIA)</span><span class="value loading" id="dow">Loading...</span></li>
        <li><span class="label">Ethereum</span><span class="value loading" id="eth">Loading...</span></li>
        <li><span class="label">Solana</span><span class="value loading" id="sol">Loading...</span></li>
        <li><span class="label">Mag 7 (Combined)</span><span class="value loading" id="mag7">Loading...</span></li>
        <li><span class="label">S&amp;P 493 (Est.)</span><span class="value loading" id="sp493">Loading...</span></li>
        <li><span class="label">10 Year Bond (TNX)</span><span class="value loading" id="bond10yr">Loading...</span></li>
        <li><span class="label">GBP/USD</span><span class="value loading" id="gbpusd">Loading...</span></li>
        <li><span class="label">EUR/USD</span><span class="value loading" id="eurusd">Loading...</span></li>
        <li><span class="label">FTSE 100 (ISF.L)</span><span class="value loading" id="ftse100">Loading...</span></li>
        <li><span class="label">Nikkei 225 (^N225)</span><span class="value loading" id="nikkei225">Loading...</span></li>
    </ul>
</details>

<details open>
    <summary>ğŸ“° News Feed</summary>
    <ul id="news-feed">
        <li><span class="value loading">Loading...</span></li>
    </ul>
</details>

<script>
    // â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentPrice = 0;
    let marketCap    = 0;
    let goldPrice    = 0;

    // â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function fmt(num, dec = 2) {
        if (num === null || num === undefined || isNaN(num)) return 'N/A';
        return Number(num).toLocaleString('en-US', { minimumFractionDigits: dec, maximumFractionDigits: dec });
    }

    function setVal(id, text, colorClass) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = text;
        el.classList.remove('loading', 'green', 'red', 'yellow');
        if (colorClass) el.classList.add(colorClass);
    }

    function setErr(id, msg) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = 'âš  ' + msg;
        el.classList.remove('loading');
        el.classList.add('error');
    }

    function fmtDate(dateStr) {
        return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function fmtUnixDate(unix) {
        return new Date(unix * 1000).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // â”€â”€â”€ 1. BTC core data via CoinGecko (free, CORS ok) â”€â”€â”€â”€â”€â”€
    async function fetchBTCMetrics() {
        try {
            const r = await fetch(
                'https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false',
                { cache: 'no-cache' }
            );
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            const md = d.market_data;

            currentPrice = md.current_price.usd || 0;
            marketCap    = md.market_cap.usd    || 0;
            const high24 = md.high_24h.usd      || 0;
            const low24  = md.low_24h.usd       || 0;
            const ath    = md.ath.usd            || 0;
            const supply = md.circulating_supply || 0;
            const dd     = ath ? ((currentPrice - ath) / ath * 100).toFixed(2) : 'N/A';

            setVal('btc-price',    `$${fmt(currentPrice)}`);
            setVal('range24',      `$${fmt(low24)} â€“ $${fmt(high24)}`);
            setVal('market-cap',   `$${fmt(marketCap / 1e12)}T`);
            setVal('sats-usd',     currentPrice ? `${fmt(1e8 / currentPrice, 0)} sats` : 'N/A');
            setVal('ath-price',    `$${fmt(ath)}`);
            setVal('drawdown-ath', `${dd}%`, 'red');
            setVal('ath-date',     fmtDate(md.ath_date.usd));
            setVal('money-supply', `${fmt(supply, 0)} BTC`);

            console.log('âœ… BTC metrics loaded');
        } catch (e) {
            console.error('âŒ BTC metrics:', e);
            setErr('btc-price', 'CoinGecko â€“ ' + e.message);
        }
    }

    // â”€â”€â”€ 2. Fear & Greed (alternative.me â€“ CORS ok) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchFearGreed() {
        try {
            const r = await fetch('https://api.alternative.me/fng/?limit=1');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            const item   = d.data[0];
            const v      = item.value;
            const label  = item.value_classification;
            const color  = label.includes('Greed') ? 'green' : label.includes('Fear') ? 'red' : 'yellow';
            const el     = document.getElementById('fear-greed');
            el.innerHTML = `<a href="https://www.coinglass.com/FearGreedIndex" target="_blank" style="color:inherit;text-decoration:none">${v} (${label})</a>`;
            el.classList.remove('loading');
            el.classList.add(color);
            console.log('âœ… Fear & Greed loaded');
        } catch (e) {
            console.error('âŒ Fear & Greed:', e);
            setErr('fear-greed', e.message);
        }
    }

    // â”€â”€â”€ 3. On-chain via Mempool.space (CORS ok) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchOnChain() {
        // Block height
        try {
            const r = await fetch('https://mempool.space/api/blocks/tip/height');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const h = parseInt(await r.text(), 10);
            setVal('block-height', fmt(h, 0));
        } catch (e) { setErr('block-height', e.message); }

        // Difficulty / retarget
        try {
            const r = await fetch('https://mempool.space/api/v1/difficulty-adjustment');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            console.log('Difficulty data:', d);  // DEBUG â€“ inspect field names

            // averageBlockTime is in SECONDS (not ms) on current Mempool API
            const avgSec = d.timeAvg || d.averageBlockTime;
            if (avgSec && !isNaN(avgSec)) {
                const secs = Math.round(avgSec);  // already seconds
                setVal('avg-block-time', `${Math.floor(secs / 60)}m ${secs % 60}s`);
            } else {
                setVal('avg-block-time', 'N/A');
            }

            // retarget date â€“ Mempool returns ms epoch
            const retargetMs = d.estimatedRetargetDate;
            if (retargetMs) {
                setVal('retarget-date', fmtUnixDate(retargetMs / 1000));
            }
        } catch (e) { setErr('avg-block-time', e.message); setErr('retarget-date', e.message); }

        // Hash rate
        try {
            const r = await fetch('https://mempool.space/api/v1/mining/hashrate/1m');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            // currentHashrate is in H/s
            const eh = d.currentHashrate / 1e18;
            setVal('hash-rate', `${fmt(eh, 0)} EH/s`);
        } catch (e) { setErr('hash-rate', e.message); }

        // Fees
        try {
            const r = await fetch('https://mempool.space/api/v1/fees/recommended');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            setVal('fee-next',   `${d.fastestFee} sat/vB`);
            setVal('fee-30min',  `${d.halfHourFee} sat/vB`);
            setVal('fee-1hr',    `${d.hourFee} sat/vB`);
        } catch (e) { setErr('fee-next', e.message); }

        console.log('âœ… On-chain loaded');
    }

    // â”€â”€â”€ 4. Realized Price via CoinMetrics (free, CORS ok) â”€â”€â”€
    async function fetchRealizedPrice() {
        try {
            const r = await fetch(
                'https://community-api.coinmetrics.io/v4/timeseries/asset-metrics?assets=btc&metrics=CapRealUSD,SplyCur&limit_per_asset=1&page_size=1',
                { cache: 'no-cache' }
            );
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d    = await r.json();
            const item = d.data?.[0];
            if (!item) throw new Error('No data');
            const realizedCap   = parseFloat(item.CapRealUSD);
            const supply        = parseFloat(item.SplyCur);
            const realizedPrice = realizedCap / supply;
            setVal('realized-price', `$${fmt(realizedPrice)}`);
            console.log('âœ… Realized price loaded');
        } catch (e) {
            console.error('âŒ Realized price:', e);
            setErr('realized-price', e.message);
        }
    }

    // â”€â”€â”€ 5. Gold/Silver via metals-api.com OR frankfurter â”€â”€â”€â”€
    // Using open.er-api.com for XAU/XAG rates (free, no key, CORS ok)
    async function fetchGoldSilver() {
        try {
            // ExchangeRate-API gives us USD/XAU and USD/XAG
            const r = await fetch('https://open.er-api.com/v6/latest/USD');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            // Rates are "1 USD = X units", so for gold: 1 USD = 0.000X XAU
            // Invert to get USD per troy oz
            const xauRate = d.rates['XAU']; // oz of gold per 1 USD
            const xagRate = d.rates['XAG'];
            if (!xauRate || !xagRate) throw new Error('XAU/XAG not in response');
            goldPrice = 1 / xauRate;        // USD per oz
            const silverPrice = 1 / xagRate;

            setVal('gold',   `$${fmt(goldPrice)}/oz`);
            setVal('silver', `$${fmt(silverPrice)}/oz`);

            // Derived gold metrics (requires currentPrice & marketCap set first)
            if (currentPrice > 0 && goldPrice > 0) {
                const goldMc    = goldPrice * 12_000_000_000; // ~200k tonnes * 32150.7 oz/tonne * price
                // More accurate: world gold ~212,582 tonnes = 6.83B oz
                const goldOzTotal = 6_830_000_000;
                const goldMcReal  = goldPrice * goldOzTotal;
                const btcGoldKg   = currentPrice / (goldPrice * 32.1507);
                const btcGoldMc   = marketCap / goldMcReal;

                setVal('btc-gold-kg', `${fmt(btcGoldKg, 2)} kg`);
                setVal('btc-gold-mc', `${fmt(btcGoldMc * 100, 1)}% of gold`);
                setVal('gold-mc',     `$${fmt(goldMcReal / 1e12, 2)}T`);
            }
            console.log('âœ… Gold/Silver loaded');
        } catch (e) {
            console.error('âŒ Gold/Silver:', e);
            setErr('gold', e.message);
            setErr('silver', e.message);
            setErr('btc-gold-kg', 'Needs gold price');
            setErr('btc-gold-mc', 'Needs gold price');
            setErr('gold-mc',     'Needs gold price');
        }
    }

    // â”€â”€â”€ 6. Historical MAs + Power Law (CoinGecko) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchHistorical() {
        try {
            const r = await fetch(
                'https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=200&interval=daily'
            );
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d      = await r.json();
            const prices = d.prices;   // [ [timestamp, price], ... ]
            if (!prices || prices.length < 50) throw new Error('Not enough data');

            const last200 = prices.slice(-200);
            const last50  = prices.slice(-50);
            const ma200   = last200.reduce((s, p) => s + p[1], 0) / last200.length;
            const ma50    = last50.reduce((s, p)  => s + p[1], 0) / last50.length;

            // Power law â€“ Giovanni Santostasi model coefficients
            // log10(price) = 5.8 * log10(days) - 19.3  (commonly cited version)
            const genesisTs      = 1231006505; // 2009-01-03 in Unix
            const daysSinceGenesis = (Date.now() / 1000 - genesisTs) / 86400;
            const powerLawProj   = Math.pow(10, 5.8 * Math.log10(daysSinceGenesis) - 19.3);
            const ratio          = currentPrice > 0 ? currentPrice / powerLawProj : 0;
            const ratioColor     = ratio > 1.5 ? 'red' : ratio < 0.7 ? 'green' : 'yellow';

            setVal('ma-50',              `$${fmt(ma50)}`);
            setVal('ma-200',             `$${fmt(ma200)}`);
            setVal('power-law-projected',`$${fmt(powerLawProj)}`);
            setVal('power-law-ratio',    `${fmt(ratio, 2)}x`, ratioColor);
            console.log('âœ… Historical loaded');
        } catch (e) {
            console.error('âŒ Historical:', e);
            setErr('ma-50', e.message);
            setErr('ma-200', e.message);
            setErr('power-law-projected', e.message);
        }
    }

    // â”€â”€â”€ 7. Crypto alts (ETH, SOL) via CoinGecko â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchAltcoins() {
        try {
            const r = await fetch(
                'https://api.coingecko.com/api/v3/simple/price?ids=ethereum,solana&vs_currencies=usd&include_24hr_change=true'
            );
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            const ethP = d.ethereum?.usd;
            const ethC = d.ethereum?.usd_24h_change;
            const solP = d.solana?.usd;
            const solC = d.solana?.usd_24h_change;
            setVal('eth', `$${fmt(ethP)} (${ethC > 0 ? '+' : ''}${fmt(ethC, 1)}%)`, ethC > 0 ? 'green' : 'red');
            setVal('sol', `$${fmt(solP)} (${solC > 0 ? '+' : ''}${fmt(solC, 1)}%)`, solC > 0 ? 'green' : 'red');
            console.log('âœ… Altcoins loaded');
        } catch (e) {
            console.error('âŒ Altcoins:', e);
            setErr('eth', e.message);
            setErr('sol', e.message);
        }
    }

    // â”€â”€â”€ 8. Stocks via Yahoo Finance (no key, usually CORS ok) â”€â”€
    // Using a CORS proxy for Yahoo Finance since direct calls are blocked
    async function fetchStocks() {
        const PROXY = 'https://corsproxy.io/?';

        async function yahooQuote(symbol) {
            const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}?interval=1d&range=2d`;
            try {
                const r = await fetch(PROXY + encodeURIComponent(url));
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                const d     = await r.json();
                const meta  = d.chart?.result?.[0]?.meta;
                if (!meta) throw new Error('No meta');
                const price = meta.regularMarketPrice;
                const prev  = meta.previousClose || meta.chartPreviousClose;
                const chgPct = prev ? ((price - prev) / prev * 100) : null;
                return { price, chgPct };
            } catch (e) {
                console.warn(`Yahoo ${symbol}:`, e.message);
                return null;
            }
        }

        const symbols = {
            sp500:    'SPY',
            dow:      'DIA',
            bond10yr: '^TNX',
            ftse100:  'ISF.L',
            nikkei225:'^N225',
        };

        for (const [id, sym] of Object.entries(symbols)) {
            const q = await yahooQuote(sym);
            if (q && q.price) {
                const chg   = q.chgPct;
                const color = chg > 0 ? 'green' : 'red';
                const sign  = chg > 0 ? '+' : '';
                if (id === 'bond10yr') {
                    setVal(id, `${fmt(q.price, 3)}% (${sign}${fmt(chg, 2)}%)`, color);
                } else {
                    setVal(id, `${fmt(q.price)} (${sign}${fmt(chg, 2)}%)`, color);
                }
            } else {
                setErr(id, 'No data');
            }
        }

        // Forex via open.er-api.com (already called, but re-use here for FX display)
        try {
            const r = await fetch('https://open.er-api.com/v6/latest/USD');
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            const gbp = d.rates['GBP'];
            const eur = d.rates['EUR'];
            setVal('gbpusd', gbp ? fmt(1 / gbp, 4) : 'N/A');
            setVal('eurusd', eur ? fmt(1 / eur, 4) : 'N/A');
        } catch (e) {
            setErr('gbpusd', e.message);
            setErr('eurusd', e.message);
        }

        // Mag 7 combined market cap via Yahoo batch
        const mag7Tickers = ['AAPL','AMZN','GOOGL','META','MSFT','NVDA','TSLA'];
        let mag7Total = 0;
        for (const sym of mag7Tickers) {
            try {
                const url = `https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=1d&range=1d`;
                const r   = await fetch(PROXY + encodeURIComponent(url));
                if (!r.ok) continue;
                const d   = await r.json();
                const meta = d.chart?.result?.[0]?.meta;
                if (!meta) continue;
                const mc = meta.marketCap || 0;
                mag7Total += mc;
            } catch (_) {}
        }
        if (mag7Total > 0) {
            setVal('mag7', `$${fmt(mag7Total / 1e12, 2)}T`);
            const sp500EstMc = 45e12;
            setVal('sp493', `$${fmt((sp500EstMc - mag7Total) / 1e12, 2)}T (est.)`);
        } else {
            setErr('mag7', 'No data');
            setErr('sp493', 'No data');
        }

        console.log('âœ… Stocks attempted');
    }

    // â”€â”€â”€ 9. News via CryptoPanic (public endpoint, no key needed) â”€â”€
    async function fetchNews() {
        try {
            // Using a public RSS-to-JSON service with a crypto-focused feed
            const FEED = 'https://feeds.feedburner.com/CoinDesk';
            const r    = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(FEED)}&count=6`);
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            const d = await r.json();
            if (d.status !== 'ok' || !d.items?.length) throw new Error(d.message || 'Bad response');

            const list = document.getElementById('news-feed');
            list.innerHTML = '';
            d.items.slice(0, 6).forEach(item => {
                const li   = document.createElement('li');
                const date = new Date(item.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                li.innerHTML = `
                    <a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>
                    <span class="news-date">${date}</span>
                `;
                list.appendChild(li);
            });
            console.log('âœ… News loaded');
        } catch (e) {
            console.error('âŒ News:', e);
            // Fallback: try a different feed
            try {
                const FEED2 = 'https://cointelegraph.com/rss';
                const r2    = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(FEED2)}&count=6`);
                const d2    = await r2.json();
                if (d2.status !== 'ok' || !d2.items?.length) throw new Error('Fallback failed');
                const list = document.getElementById('news-feed');
                list.innerHTML = '';
                d2.items.slice(0, 6).forEach(item => {
                    const li   = document.createElement('li');
                    const date = new Date(item.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    li.innerHTML = `
                        <a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>
                        <span class="news-date">${date}</span>
                    `;
                    list.appendChild(li);
                });
                console.log('âœ… News (fallback) loaded');
            } catch (e2) {
                document.getElementById('news-feed').innerHTML = `<li><span class="error">âš  ${e2.message}</span></li>`;
            }
        }
    }

    // â”€â”€â”€ Main refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function refreshAll() {
        document.getElementById('last-update').textContent = 'Refreshing...';
        try {
            // Run independent fetches in parallel where possible
            await fetchBTCMetrics();   // currentPrice & marketCap must be set first
            await Promise.allSettled([
                fetchFearGreed(),
                fetchOnChain(),
                fetchRealizedPrice(),
                fetchGoldSilver(),     // uses currentPrice / marketCap from step 1
                fetchHistorical(),
                fetchAltcoins(),
                fetchNews(),
            ]);
            await fetchStocks();       // slowest â€“ many sequential Yahoo calls
        } catch (e) {
            console.error('Refresh error:', e);
        }
        const now = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('last-update').textContent = `Last updated: ${now}`;
    }

    refreshAll();
    setInterval(refreshAll, 60_000);
</script>
```

</body>
</html>