<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandon's Dashboard</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.5;
            font-size: 1.1em; /* Slightly bigger base font */
        }
        h1 {
            text-align: center;
            color: #ffffff;
            font-size: 1.8em; /* Bigger title */
            margin-bottom: 20px;
        }
        #chart {
            height: 300px;
            background-color: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        #toggle-chart {
            display: block;
            margin: 0 auto 20px;
            padding: 8px 16px;
            background: #333333;
            color: #e0e0e0;
            border: 1px solid #444444;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em; /* Match bigger font */
        }
        #toggle-chart:hover {
            background: #444444;
        }
        details {
            background: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        summary {
            padding: 12px 16px;
            background: #2a2a2a;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.2em;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        li {
            padding: 12px 16px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em; /* Bigger metric font */
        }
        li:last-child {
            border-bottom: none;
        }
        .label {
            color: #ffffff; /* White labels */
            font-weight: normal;
        }
        .value {
            color: #ffffff;
            font-weight: bold;
        }
        .green {
            color: #00ff00;
        }
        .red {
            color: #ff0000;
        }
        .yellow {
            color: #ffff00;
        }
        /* For future icons: .icon { margin-left: 8px; color: #a0a0a0; } .icon:hover { color: #00bfff; } */
    </style>
</head>
<body>
    <h1>Brandon's Dashboard</h1>
    
    <details open>
        <summary>Bitcoin</summary>
        <div id="chart"></div>
        <button id="toggle-chart">Toggle to Line Chart</button>
        <ul id="btc-metrics">
            <li><span class="label">24hr Range</span><span class="value" id="range24">Loading...</span></li>
            <li><span class="label">Market Cap</span><span class="value" id="market-cap">Loading...</span></li>
            <li><span class="label">Sats per USD</span><span class="value" id="sats-usd">Loading...</span></li>
            <li><span class="label">ATH Price</span><span class="value" id="ath-price">Loading...</span><!-- Optional: <a href="https://charts.bitbo.io/ath" target="_blank" class="icon"><i class="fa fa-chart-line"></i></a> --></li>
            <li><span class="label">Drawdown Since ATH</span><span class="value" id="drawdown-ath">Loading...</span><!-- Optional: <a href="https://charts.bitbo.io/drawdown-from-ath" target="_blank" class="icon"><i class="fa fa-chart-line"></i></a> --></li>
            <li><span class="label">ATH Date</span><span class="value" id="ath-date">Loading...</span></li>
            <li><span class="label">Fear & Greed Index</span><span class="value" id="fear-greed"><a href="https://www.coinglass.com/FearGreedIndex" target="_blank" style="color: inherit; text-decoration: none;">Loading...</a></span></li>
            <li><span class="label">Realized Price</span><span class="value" id="realized-price">Loading...</span><!-- Optional: <a href="https://charts.bitbo.io/realized-price" target="_blank" class="icon"><i class="fa fa-chart-line"></i></a> --></li>
            <li><span class="label">Block Height</span><span class="value" id="block-height">Loading...</span></li>
            <li><span class="label">Average Block Time</span><span class="value" id="avg-block-time">Loading...</span></li>
            <li><span class="label">Money Supply</span><span class="value" id="money-supply">Loading...</span></li>
            <li><span class="label">Estimated Retarget Date</span><span class="value" id="retarget-date">Loading...</span></li>
            <li><span class="label">Hash Rate (24hrs)</span><span class="value" id="hash-rate">Loading...</span><!-- Optional: <a href="https://charts.bitbo.io/hash-rate" target="_blank" class="icon"><i class="fa fa-chart-line"></i></a> --></li>
            <li><span class="label">Median Fee – Next Block</span><span class="value" id="fee-next">Loading...</span></li>
            <li><span class="label">Median Fee – 30 Minutes</span><span class="value" id="fee-30min">Loading...</span></li>
            <li><span class="label">Median Fee – 1 Hour</span><span class="value" id="fee-1hr">Loading...</span></li>
            <li><span class="label">Bitcoin Price in Gold Kg</span><span class="value" id="btc-gold-kg">Loading...</span></li>
            <li><span class="label">Bitcoin vs Gold Market Cap</span><span class="value" id="btc-gold-mc">Loading...</span></li>
            <li><span class="label">Gold Market Cap</span><span class="value" id="gold-mc">Loading...</span></li>
            <li><span class="label">50-Day Moving Average</span><span class="value" id="ma-50">Loading...</span></li>
            <li><span class="label">200-Day Moving Average</span><span class="value" id="ma-200">Loading...</span></li>
            <li><span class="label">Power Law Projected Price</span><span class="value" id="power-law-projected">Loading...</span><!-- Optional: <a href="https://charts.bitbo.io/long-term-power-law" target="_blank" class="icon"><i class="fa fa-chart-line"></i></a> --></li>
            <li><span class="label">Power Law Actual Price vs Projected</span><span class="value" id="power-law-ratio">Loading...</span></li>
        </ul>
    </details>
    
    <details open>
        <summary>Stocks and Other Assets</summary>
        <ul id="assets-metrics">
            <li><span class="label">Gold Spot</span><span class="value" id="gold">Loading...</span></li>
            <li><span class="label">Silver Spot</span><span class="value" id="silver">Loading...</span></li>
            <li><span class="label">S&P 500</span><span class="value" id="sp500">Loading...</span></li>
            <li><span class="label">DOW</span><span class="value" id="dow">Loading...</span></li>
            <li><span class="label">Ethereum</span><span class="value" id="eth">Loading...</span></li>
            <li><span class="label">Solana</span><span class="value" id="sol">Loading...</span></li>
            <li><span class="label">Mag 7 (Combined)</span><span class="value" id="mag7">Loading...</span></li>
            <li><span class="label">S&P 493</span><span class="value" id="sp493">Loading...</span></li>
            <li><span class="label">10 Year Bond Interest Rate</span><span class="value" id="bond10yr">Loading...</span></li>
            <li><span class="label">GBP/USD</span><span class="value" id="gbpusd">Loading...</span></li>
            <li><span class="label">EUR/USD</span><span class="value" id="eurusd">Loading...</span></li>
            <li><span class="label">FTSE 100</span><span class="value" id="ftse100">Loading...</span></li>
            <li><span class="label">Nikkei 225</span><span class="value" id="nikkei225">Loading...</span></li>
        </ul>
    </details>

    <script>
        let chartData = []; // Store chart data globally for toggle
        let currentPrice = 0; // Store current BTC price for calculations

        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: document.body.clientWidth - 40,
            height: 300,
            layout: { background: { color: '#1e1e1e' }, textColor: '#e0e0e0' },
            grid: { vertLines: { color: '#2a2a2a' }, horLines: { color: '#2a2a2a' } },
            timeScale: { timeVisible: true, secondsVisible: false, borderColor: '#444444' },
            rightPriceScale: { borderColor: '#444444' },
            handleScroll: false,  // Disable zoom/pan
            handleScale: false   // Disable zoom/pan
        });
        let series = chart.addCandlestickSeries({
            upColor: '#00ff00', downColor: '#ff0000',
            borderVisible: false, wickUpColor: '#00ff00', wickDownColor: '#ff0000'
        });

        // Toggle button
        const toggleBtn = document.getElementById('toggle-chart');
        let isCandle = true;
        toggleBtn.addEventListener('click', () => {
            chart.removeSeries(series);
            if (isCandle) {
                series = chart.addLineSeries({ color: '#00bfff', lineWidth: 2 });
                toggleBtn.textContent = 'Toggle to Candle Chart';
                series.setData(chartData.map(d => ({ time: d.time, value: d.close }))); // Line uses close
            } else {
                series = chart.addCandlestickSeries({
                    upColor: '#00ff00', downColor: '#ff0000',
                    borderVisible: false, wickUpColor: '#00ff00', wickDownColor: '#ff0000'
                });
                toggleBtn.textContent = 'Toggle to Line Chart';
                series.setData(chartData); // Candles use OHLC
            }
            isCandle = !isCandle;
        });

        // Format numbers like Bitbo (commas, 2 decimals for prices, etc.)
        function formatNumber(num, decimals = 2, suffix = '') {
            return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }) + suffix;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Fetch BTC chart data (30 days OHLC)
        async function fetchBTCChart() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/ohlc?vs_currency=usd&days=30');
                const data = await response.json();
                chartData = data.map(d => ({
                    time: Math.floor(d[0] / 1000), // ms to seconds
                    open: d[1],
                    high: d[2],
                    low: d[3],
                    close: d[4]
                }));
                series.setData(chartData);
            } catch (error) {
                console.error('Chart error:', error);
                // Optional: Show error on page, e.g., document.getElementById('chart').innerHTML = '<p style="color: red; text-align: center;">Error loading chart</p>';
            }
        }

        // Fetch core BTC metrics from CoinGecko
        async function fetchBTCMetrics() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin');
                const data = await response.json();
                currentPrice = data.market_data.current_price.usd;
                const high24 = data.market_data.high_24h.usd;
                const low24 = data.market_data.low_24h.usd;
                const marketCap = data.market_data.market_cap.usd;
                const athPrice = data.market_data.ath.usd;
                const athDate = formatDate(data.market_data.ath_date.usd);
                const drawdown = ((currentPrice - athPrice) / athPrice * 100).toFixed(2);
                const satsPerUsd = formatNumber(100000000 / currentPrice, 0) + ' sats';

                document.getElementById('range24').textContent = `$${formatNumber(low24)} - $${formatNumber(high24)}`;
                document.getElementById('market-cap').textContent = `$${formatNumber(marketCap / 1000000000000, 2)}T`;
                document.getElementById('sats-usd').textContent = satsPerUsd;
                document.getElementById('ath-price').textContent = `$${formatNumber(athPrice)}`;
                document.getElementById('drawdown-ath').textContent = `${drawdown}%`;
                document.getElementById('drawdown-ath').classList.add('red'); // Always red for drawdown
                document.getElementById('ath-date').textContent = athDate;
            } catch (error) {
                console.error('BTC metrics error:', error);
                document.getElementById('range24').textContent = 'Error';
                // Repeat for others if needed
            }
        }

        // Fetch Fear & Greed Index
        async function fetchFearGreed() {
            try {
                const response = await fetch('https://api.alternative.me/fng/?limit=1');
                const data = await response.json();
                const fng = data.data[0];
                const value = fng.value;
                const classification = fng.value_classification;
                const colorClass = classification.includes('Greed') ? 'green' : classification.includes('Fear') ? 'red' : 'yellow';
                const link = document.getElementById('fear-greed').querySelector('a');
                link.textContent = `${value} (${classification})`;
                link.parentElement.classList.add(colorClass);
            } catch (error) {
                console.error('FNG error:', error);
                document.getElementById('fear-greed').querySelector('a').textContent = 'Error';
            }
        }

        // Auto-refresh
        async function refreshData() {
            await Promise.all([
                fetchBTCChart(),
                fetchBTCMetrics(),
                fetchFearGreed()
                // More fetches in next batches
            ]);
        }
        refreshData();
        setInterval(refreshData, 60000);
    </script>
</body>
</html>
