<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandon's Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 10px;
            line-height: 1.4;
            font-size: 0.9em; /* Smaller for mobile */
        }
        h1 {
            text-align: center;
            color: #ffffff;
            font-size: 1.5em; /* Smaller title for mobile */
            margin-bottom: 15px;
        }
        details {
            background: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        summary {
            padding: 10px 12px;
            background: #2a2a2a;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.0em;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        li {
            padding: 8px 12px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em; /* Smaller metric font for mobile */
        }
        li:last-child {
            border-bottom: none;
        }
        .label {
            color: #ffffff; /* White labels */
            font-weight: normal;
        }
        .value {
            color: #ffffff;
            font-weight: bold;
        }
        .green {
            color: #00ff00;
        }
        .red {
            color: #ff0000;
        }
        .yellow {
            color: #ffff00;
        }
        #news-feed li {
            flex-direction: column;
            align-items: flex-start;
        }
        @media (min-width: 600px) {
            body {
                font-size: 1.1em;
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            summary {
                font-size: 1.2em;
            }
            li {
                font-size: 1.1em;
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <h1>Brandon's Dashboard</h1>
    
    <details open>
        <summary>Bitcoin</summary>
        <ul id="btc-metrics">
            <li><span class="label">24hr Range</span><span class="value" id="range24">Loading...</span></li>
            <li><span class="label">Market Cap</span><span class="value" id="market-cap">Loading...</span></li>
            <li><span class="label">Sats per USD</span><span class="value" id="sats-usd">Loading...</span></li>
            <li><span class="label">ATH Price</span><span class="value" id="ath-price">Loading...</span></li>
            <li><span class="label">Drawdown Since ATH</span><span class="value" id="drawdown-ath">Loading...</span></li>
            <li><span class="label">ATH Date</span><span class="value" id="ath-date">Loading...</span></li>
            <li><span class="label">Fear & Greed Index</span><span class="value" id="fear-greed"><a href="https://www.coinglass.com/FearGreedIndex" target="_blank" style="color: inherit; text-decoration: none;">Loading...</a></span></li>
            <li><span class="label">Realized Price</span><span class="value" id="realized-price">Loading...</span></li>
            <li><span class="label">Block Height</span><span class="value" id="block-height">Loading...</span></li>
            <li><span class="label">Average Block Time</span><span class="value" id="avg-block-time">Loading...</span></li>
            <li><span class="label">Money Supply</span><span class="value" id="money-supply">Loading...</span></li>
            <li><span class="label">Estimated Retarget Date</span><span class="value" id="retarget-date">Loading...</span></li>
            <li><span class="label">Hash Rate (24hrs)</span><span class="value" id="hash-rate">Loading...</span></li>
            <li><span class="label">Median Fee – Next Block</span><span class="value" id="fee-next">Loading...</span></li>
            <li><span class="label">Median Fee – 30 Minutes</span><span class="value" id="fee-30min">Loading...</span></li>
            <li><span class="label">Median Fee – 1 Hour</span><span class="value" id="fee-1hr">Loading...</span></li>
            <li><span class="label">Bitcoin Price in Gold Kg</span><span class="value" id="btc-gold-kg">Loading...</span></li>
            <li><span class="label">Bitcoin vs Gold Market Cap</span><span class="value" id="btc-gold-mc">Loading...</span></li>
            <li><span class="label">Gold Market Cap</span><span class="value" id="gold-mc">Loading...</span></li>
            <li><span class="label">50-Day Moving Average</span><span class="value" id="ma-50">Loading...</span></li>
            <li><span class="label">200-Day Moving Average</span><span class="value" id="ma-200">Loading...</span></li>
            <li><span class="label">Power Law Projected Price</span><span class="value" id="power-law-projected">Loading...</span></li>
            <li><span class="label">Power Law Actual Price vs Projected</span><span class="value" id="power-law-ratio">Loading...</span></li>
        </ul>
    </details>
    
    <details open>
        <summary>Stocks and Other Assets</summary>
        <ul id="assets-metrics">
            <li><span class="label">Gold Spot</span><span class="value" id="gold">Loading...</span></li>
            <li><span class="label">Silver Spot</span><span class="value" id="silver">Loading...</span></li>
            <li><span class="label">S&P 500</span><span class="value" id="sp500">Loading...</span></li>
            <li><span class="label">DOW</span><span class="value" id="dow">Loading...</span></li>
            <li><span class="label">Ethereum</span><span class="value" id="eth">Loading...</span></li>
            <li><span class="label">Solana</span><span class="value" id="sol">Loading...</span></li>
            <li><span class="label">Mag 7 (Combined)</span><span class="value" id="mag7">Loading...</span></li>
            <li><span class="label">S&P 493</span><span class="value" id="sp493">Loading...</span></li>
            <li><span class="label">10 Year Bond Interest Rate</span><span class="value" id="bond10yr">Loading...</span></li>
            <li><span class="label">GBP/USD</span><span class="value" id="gbpusd">Loading...</span></li>
            <li><span class="label">EUR/USD</span><span class="value" id="eurusd">Loading...</span></li>
            <li><span class="label">FTSE 100</span><span class="value" id="ftse100">Loading...</span></li>
            <li><span class="label">Nikkei 225</span><span class="value" id="nikkei225">Loading...</span></li>
        </ul>
    </details>

    <script>
        let currentPrice = 0; // Store current BTC price for calculations
        let marketCap = 0; // Store BTC market cap
        let goldPrice = 0; // Store gold price for calculations

        // Format numbers like Bitbo (commas, 2 decimals for prices, etc.)
        function formatNumber(num, decimals = 2, suffix = '') {
            if (num === null || num === undefined) return 'N/A';
            return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }) + suffix;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatUnixDate(unix) {
            const date = new Date(unix * 1000);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}m ${secs}s`;
        }

        // Fetch core BTC metrics from CoinGecko
        async function fetchBTCMetrics() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false');
                if (!response.ok) throw new Error('Response not OK: ' + response.status);
                const data = await response.json();
                currentPrice = data.market_data.current_price.usd || 0;
                marketCap = data.market_data.market_cap.usd || 0;
                const high24 = data.market_data.high_24h.usd || 0;
                const low24 = data.market_data.low_24h.usd || 0;
                const athPrice = data.market_data.ath.usd || 0;
                const athDate = formatDate(data.market_data.ath_date.usd);
                const drawdown = athPrice ? ((currentPrice - athPrice) / athPrice * 100).toFixed(2) : 'N/A';
                const satsPerUsd = currentPrice ? formatNumber(100000000 / currentPrice, 0) + ' sats' : 'N/A';
                const circulatingSupply = data.market_data.circulating_supply || 0;

                document.getElementById('range24').textContent = `$${formatNumber(low24)} - $${formatNumber(high24)}`;
                document.getElementById('market-cap').textContent = `$${formatNumber(marketCap / 1000000000000, 2)}T`;
                document.getElementById('sats-usd').textContent = satsPerUsd;
                document.getElementById('ath-price').textContent = `$${formatNumber(athPrice)}`;
                document.getElementById('drawdown-ath').textContent = `${drawdown}%`;
                if (document.getElementById('drawdown-ath')) document.getElementById('drawdown-ath').classList.add('red');
                document.getElementById('ath-date').textContent = athDate;
                document.getElementById('money-supply').textContent = formatNumber(circulatingSupply, 2) + ' BTC';
            } catch (error) {
                console.error('BTC metrics error:', error);
                document.getElementById('range24').textContent = 'BTC Metrics Error: ' + error.message;
            }
        }

        // Fetch Fear & Greed Index
        async function fetchFearGreed() {
            try {
                const response = await fetch('https://api.alternative.me/fng/?limit=1');
                if (!response.ok) throw new Error('Response not OK: ' + response.status);
                const data = await response.json();
                const fng = data.data[0];
                const value = fng.value;
                const classification = fng.value_classification;
                const colorClass = classification.includes('Greed') ? 'green' : classification.includes('Fear') ? 'red' : 'yellow';
                const link = document.getElementById('fear-greed').querySelector('a');
                link.textContent = `${value} (${classification})`;
                link.parentElement.classList.add(colorClass);
            } catch (error) {
                console.error('FNG error:', error);
                document.getElementById('fear-greed').querySelector('a').textContent = 'FNG Error: ' + error.message;
            }
        }

        // Fetch on-chain metrics from Mempool.space
        async function fetchOnChainMetrics() {
            try {
                const blockResponse = await fetch('https://mempool.space/api/blocks/tip/height');
                if (!blockResponse.ok) throw new Error('Block height response not OK: ' + blockResponse.status);
                const blockHeight = await blockResponse.text();
                const heightElem = document.getElementById('block-height');
                if (heightElem) heightElem.textContent = formatNumber(parseInt(blockHeight, 10), 0);

                const difficultyResponse = await fetch('https://mempool.space/api/v1/difficulty-adjustment');
                if (!difficultyResponse.ok) throw new Error('Difficulty response not OK: ' + difficultyResponse.status);
                const difficultyData = await difficultyResponse.json();
                const retargetElem = document.getElementById('retarget-date');
                if (retargetElem) retargetElem.textContent = formatUnixDate(difficultyData.estimatedRetargetDate / 1000);
                const avgTimeElem = document.getElementById('avg-block-time');
                if (avgTimeElem) avgTimeElem.textContent = formatTime(difficultyData.averageBlockTime / 1000);

                const hashResponse = await fetch('https://mempool.space/api/v1/mining/hashrate/1m');
                if (!hashResponse.ok) throw new Error('Hash rate response not OK: ' + hashResponse.status);
                const hashData = await hashResponse.json();
                const hashElem = document.getElementById('hash-rate');
                if (hashElem) hashElem.textContent = formatNumber(hashData.currentHashrate / 1e18, 0) + ' EH/s';

                const feesResponse = await fetch('https://mempool.space/api/v1/fees/recommended');
                if (!feesResponse.ok) throw new Error('Fees response not OK: ' + feesResponse.status);
                const feesData = await feesResponse.json();
                document.getElementById('fee-next').textContent = feesData.fastestFee + ' sat/vB';
                document.getElementById('fee-30min').textContent = feesData.halfHourFee + ' sat/vB';
                document.getElementById('fee-1hr').textContent = feesData.hourFee + ' sat/vB';
            } catch (error) {
                console.error('On-chain metrics error:', error);
                document.getElementById('block-height').textContent = 'On-Chain Error: ' + error.message;
            }
        }

        // Fetch realized price from Blockchain.info fallback (realized cap / supply)
        async function fetchRealizedPrice() {
            try {
                const capResponse = await fetch('https://api.blockchain.info/charts/realized-cap?format=json');
                if (!capResponse.ok) throw new Error('Realized cap response not OK: ' + capResponse.status);
                const capData = await capResponse.json();
                const realizedCap = capData.values[capData.values.length - 1].y;
                const supplyResponse = await fetch('https://api.blockchain.info/charts/total-bitcoins?format=json');
                if (!supplyResponse.ok) throw new Error('Supply response not OK: ' + supplyResponse.status);
                const supplyData = await supplyResponse.json();
                const supply = supplyData.values[supplyData.values.length - 1].y;
                const realizedPrice = realizedCap / supply;
                document.getElementById('realized-price').textContent = `$${formatNumber(realizedPrice, 2)}`;
            } catch (error) {
                console.error('Realized price error:', error);
                document.getElementById('realized-price').textContent = 'Realized Price Error: ' + error.message;
            }
        }

        // Fetch gold/silver from GoldAPI
        async function fetchGoldSilver() {
            try {
                const goldapiKey = 'YOUR_GOLDAPI_KEY'; // Free key from goldapi.io
                const response = await fetch(`https://www.goldapi.io/api/XAU/USD?api_key=${goldapiKey}`);
                if (!response.ok) throw new Error('Gold response not OK: ' + response.status);
                const data = await response.json();
                goldPrice = data.price;
                const goldChange = data.ch_p;
                const goldColor = goldChange > 0 ? 'green' : 'red';
                const goldMc = goldPrice * 12000000000;
                const btcGoldKg = currentPrice / (goldPrice * 32.1507);
                const btcGoldMc = marketCap / goldMc;

                document.getElementById('gold').textContent = `$${formatNumber(goldPrice)}/oz (${goldChange.toFixed(2)}%)`;
                document.getElementById('gold').classList.add(goldColor);
                document.getElementById('btc-gold-kg').textContent = formatNumber(btcGoldKg, 2) + ' BTC/kg';
                document.getElementById('btc-gold-mc').textContent = formatNumber(btcGoldMc, 2) + 'x';
                document.getElementById('gold-mc').textContent = `$${formatNumber(goldMc / 1000000000000, 2)}T`;

                const silverResponse = await fetch(`https://www.goldapi.io/api/XAG/USD?api_key=${goldapiKey}`);
                if (!silverResponse.ok) throw new Error('Silver response not OK: ' + silverResponse.status);
                const silverData = await silverResponse.json();
                const silverPrice = silverData.price;
                const silverChange = silverData.ch_p;
                const silverColor = silverChange > 0 ? 'green' : 'red';
                document.getElementById('silver').textContent = `$${formatNumber(silverPrice)}/oz (${silverChange.toFixed(2)}%)`;
                document.getElementById('silver').classList.add(silverColor);
            } catch (error) {
                console.error('Gold/Silver error:', error);
                document.getElementById('gold').textContent = 'Gold/Silver Error: ' + error.message;
            }
        }

        // Fetch historical for MAs and Power Law
        async function fetchHistorical() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=200');
                const data = await response.json();
                const prices = data.prices;
                const ma50 = prices.slice(-50).reduce((sum, p) => sum + p[1], 0) / 50;
                const ma200 = prices.slice(-200).reduce((sum, p) => sum + p[1], 0) / 200;
                const daysSinceGenesis = Math.floor((Date.now() / 1000 - 1231006505) / 86400);
                const powerLawProjected = Math.exp(5.71 * Math.log(daysSinceGenesis) - 38.16);
                const powerLawRatio = currentPrice / powerLawProjected;

                document.getElementById('ma-50').textContent = `$${formatNumber(ma50)}`;
                document.getElementById('ma-200').textContent = `$${formatNumber(ma200)}`;
                document.getElementById('power-law-projected').textContent = `$${formatNumber(powerLawProjected)}`;
                document.getElementById('power-law-ratio').textContent = formatNumber(powerLawRatio, 2);
            } catch (error) {
                console.error('Historical data error:', error);
                document.getElementById('ma-50').textContent = 'Historical Error: ' + error.message;
            }
        }

        // Fetch stocks and FX from Alpha Vantage
        async function fetchAssets() {
            try {
                const alphaKey = 'YOUR_ALPHA_VANTAGE_KEY'; // Replace with your free key from alphavantage.co
                const sp500Response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^GSPC&apikey=${alphaKey}`);
                const sp500Data = await sp500Response.json();
                const globalQuote = sp500Data['Global Quote'];
                const sp500Price = globalQuote['05. price'];
                const sp500Change = globalQuote['10. change percent'];
                document.getElementById('sp500').textContent = formatNumber(sp500Price, 2) + ' (' + sp500Change + ')';
                document.getElementById('sp500').classList.add(parseFloat(sp500Change) > 0 ? 'green' : 'red');

                const dowResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^DJI&apikey=${alphaKey}`);
                const dowData = await dowResponse.json();
                const dowQuote = dowData['Global Quote'];
                const dowPrice = dowQuote['05. price'];
                const dowChange = dowQuote['10. change percent'];
                document.getElementById('dow').textContent = formatNumber(dowPrice, 2) + ' (' + dowChange + ')';
                document.getElementById('dow').classList.add(parseFloat(dowChange) > 0 ? 'green' : 'red');

                const bondResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^TNX&apikey=${alphaKey}`);
                const bondData = await bondResponse.json();
                const bondQuote = bondData['Global Quote'];
                const bondPrice = bondQuote['05. price'];
                const bondChange = bondQuote['10. change percent'];
                document.getElementById('bond10yr').textContent = bondPrice + '% (' + bondChange + ')';
                document.getElementById('bond10yr').classList.add(parseFloat(bondChange) > 0 ? 'green' : 'red');

                const gbpusdResponse = await fetch(`https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=GBP&to_currency=USD&apikey=${alphaKey}`);
                const gbpusdData = await gbpusdResponse.json();
                const gbpusdPrice = gbpusdData['Realtime Currency Exchange Rate']['5. Exchange Rate'];
                document.getElementById('gbpusd').textContent = formatNumber(gbpusdPrice, 4);

                const eurusdResponse = await fetch(`https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=EUR&to_currency=USD&apikey=${alphaKey}`);
                const eurusdData = await eurusdResponse.json();
                const eurusdPrice = eurusdData['Realtime Currency Exchange Rate']['5. Exchange Rate'];
                document.getElementById('eurusd').textContent = formatNumber(eurusdPrice, 4);

                const ftseResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^FTSE&apikey=${alphaKey}`);
                const ftseData = await ftseResponse.json();
                const ftseQuote = ftseData['Global Quote'];
                const ftsePrice = ftseQuote['05. price'];
                const ftseChange = ftseQuote['10. change percent'];
                document.getElementById('ftse100').textContent = formatNumber(ftsePrice, 2) + ' (' + ftseChange + ')';
                document.getElementById('ftse100').classList.add(parseFloat(ftseChange) > 0 ? 'green' : 'red');

                const nikkeiResponse = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^N225&apikey=${alphaKey}`);
                const nikkeiData = await nikkeiResponse.json();
                const nikkeiQuote = nikkeiData['Global Quote'];
                const nikkeiPrice = nikkeiQuote['05. price'];
                const nikkeiChange = nikkeiQuote['10. change percent'];
                document.getElementById('nikkei225').textContent = formatNumber(nikkeiPrice, 2) + ' (' + nikkeiChange + ')';
                document.getElementById('nikkei225').classList.add(parseFloat(nikkeiChange) > 0 ? 'green' : 'red');

                // Mag 7 and S&P 493 (sum mc)
                const mag7Symbols = ['AAPL', 'AMZN', 'GOOG', 'META', 'MSFT', 'NVDA', 'TSLA'];
                let mag7Mc = 0;
                for (const sym of mag7Symbols) {
                    const res = await fetch(`https://www.alphavantage.co/query?function=OVERVIEW&symbol=${sym}&apikey=${alphaKey}`);
                    const d = await res.json();
                    mag7Mc += parseInt(d.MarketCapitalization || 0);
                }
                document.getElementById('mag7').textContent = `$${formatNumber(mag7Mc / 1000000000000, 2)}T`;
                const sp500Mc = 45000000000000; // Approx
                document.getElementById('sp493').textContent = `$${formatNumber((sp500Mc - mag7Mc) / 1000000000000, 2)}T`;
            } catch (error) {
                console.error('Assets error:', error);
                document.getElementById('sp500').textContent = 'Assets Error: ' + error.message;
            }
        }

        // Fetch news feed (customized for crypto, finance, tech)
        async function fetchNews() {
            try {
                const rssUrl = 'https://news.google.com/rss/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNRGx6TVdBU0FtVnVHZ0pWVXlnQVAB?hl=en-US&gl=US&ceid=US:en'; // Business news
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`);
                const data = await response.json();
                const newsList = document.getElementById('news-feed');
                newsList.innerHTML = '';
                data.items.slice(0, 5).forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a> - ${new Date(item.pubDate).toLocaleDateString()}`;
                    newsList.appendChild(li);
                });
            } catch (error) {
                console.error('News error:', error);
                document.getElementById('news-feed').innerHTML = '<li>News Error: ' + error.message + '</li>';
            }
        }

        // Auto-refresh
        async function refreshData() {
            await fetchBTCMetrics();
            await fetchFearGreed();
            await fetchOnChainMetrics();
            await fetchRealizedPrice();
            await fetchGoldSilver();
            await fetchHistorical();
            await fetchAssets();
            await fetchNews();
        }
        refreshData();
        setInterval(refreshData, 60000);
    </script>
</body>
</html>